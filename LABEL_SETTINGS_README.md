# Настройка полей на этикетках

## Описание

Добавлена возможность настройки отображения полей на этикетках в производстве. Пользователь может выбрать, какие элементы будут отображаться на каждой этикетке.

## Реализованные изменения

### 1. Модель User (models.py)

Добавлены новые поля для хранения настроек этикеток:
- `label_show_ean` - Показывать EAN-13 штрихкод
- `label_show_gs1` - Показывать GS1 текст под DataMatrix
- `label_show_title` - Показывать название товара
- `label_show_color` - Показывать цвет
- `label_show_size` - Показывать размер
- `label_show_material` - Показывать состав (материал)
- `label_show_country` - Показывать страну производства
- `label_show_ip` - Показывать ИП
- `label_show_article` - Показывать артикул (nm_id)

Все поля по умолчанию установлены в `True` (включены).

Добавлен метод `get_label_settings()` для получения настроек в виде словаря.

### 2. Страница настроек (templates/settings.html)

Добавлена новая секция "Настройка отображения полей на этикетках" с чекбоксами для каждого опционального поля.

**Важно:** DataMatrix и логотип "Честный знак" всегда отображаются (обязательные элементы маркировки).

### 3. Роут сохранения настроек (app.py)

Обновлен роут `/settings` для обработки и сохранения новых настроек этикеток.

### 4. Генератор этикеток (label_generator.py)

Модифицирована функция `generate_labels_sync()`:
- Добавлен параметр `label_settings: dict`
- Каждый опциональный элемент проверяется перед отрисовкой
- Если настройка выключена, элемент не отрисовывается

### 5. Роут производства (production_routes.py)

Обновлен для передачи настроек пользователя в генератор этикеток через `current_user.get_label_settings()`.

## Использование

1. Перейдите в **Настройки** → **Настройки бизнеса**
2. Найдите секцию **"Настройка отображения полей на этикетках"**
3. Отметьте галочками поля, которые хотите видеть на этикетках
4. Нажмите **"Сохранить изменения"**

Настройки будут применяться ко всем новым этикеткам, генерируемым при переносе товаров в производство.

## Инициализация базы данных

Для существующих установок:

```bash
# Если база данных уже существует, удалите её (будут потеряны данные!)
rm instance/wb_app.db

# Инициализируйте новую базу с новыми полями
python force_init_db.py
```

Для новых установок база данных будет автоматически создана с новыми полями при первом запуске приложения.

## Технические детали

- Все новые поля в БД имеют тип `BOOLEAN` (SQLite: `INTEGER`)
- Значения по умолчанию: `1` (True) - все поля включены
- Настройки хранятся на уровне пользователя, не сессии
- Настройки применяются динамически при генерации каждой этикетки

## Файлы затронутые изменениями

1. `models.py` - добавлены поля и метод в модель User
2. `templates/settings.html` - добавлена UI секция с чекбоксами
3. `app.py` - обновлен роут `/settings`
4. `label_generator.py` - добавлена поддержка настроек
5. `production_routes.py` - передача настроек в генератор
6. `force_init_db.py` - скрипт инициализации БД (новый)
7. `migrate_label_settings.py` - скрипт миграции (для reference)
